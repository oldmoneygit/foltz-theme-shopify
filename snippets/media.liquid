<!--
  Snippet: Media
  Descrição: Componente para renderizar diferentes tipos de mídia (image, video, model)

  Uso:
  {% render 'media', media: product.featured_media, size: 'large' %}
  {% render 'media', media: product.media[0], class: 'custom-class' %}

  Parâmetros:
  - media: Objeto media do Shopify (obrigatório)
  - size: 'small', 'medium', 'large', 'original' (padrão: 'medium')
  - class: Classes CSS adicionais
  - loading: 'lazy', 'eager' (padrão: 'lazy')
  - show_controls: true/false (para videos, padrão: true)
  - autoplay: true/false (para videos, padrão: false)
  - loop: true/false (para videos, padrão: true)
-->

<style>
  .media {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .media__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .media__video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .media__model {
    width: 100%;
    height: 100%;
  }

  .media__external-video {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    height: 0;
    overflow: hidden;
  }

  .media__external-video iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .media__play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 72px;
    height: 72px;
    background: rgba(0, 0, 0, 0.8);
    border: 3px solid var(--color-brand-yellow);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1;
  }

  .media__play-button:hover {
    background: var(--color-brand-yellow);
    transform: translate(-50%, -50%) scale(1.1);
  }

  .media__play-button svg {
    width: 32px;
    height: 32px;
    color: var(--color-brand-yellow);
    transition: color 0.3s ease;
  }

  .media__play-button:hover svg {
    color: #000000;
  }

  .media__badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 6px 12px;
    background: rgba(0, 0, 0, 0.8);
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    color: #FFFFFF;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    z-index: 1;
  }

  .media__badge--video {
    background: var(--color-brand-yellow);
    color: #000000;
  }

  .media__placeholder {
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.05);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .media__placeholder svg {
    width: 64px;
    height: 64px;
    color: var(--color-text-subdued);
    opacity: 0.3;
  }
</style>

{%- liquid
  assign media_object = media
  assign media_size = size | default: 'medium'
  assign media_class = class | default: ''
  assign media_loading = loading | default: 'lazy'
  assign media_show_controls = show_controls | default: true
  assign media_autoplay = autoplay | default: false
  assign media_loop = loop | default: true

  case media_size
    when 'small'
      assign img_size = '400x'
    when 'medium'
      assign img_size = '800x'
    when 'large'
      assign img_size = '1200x'
    when 'original'
      assign img_size = 'master'
    else
      assign img_size = '800x'
  endcase
-%}

{%- if media_object -%}
  <div class="media {{ media_class }}" data-media-type="{{ media_object.media_type }}">
    {%- case media_object.media_type -%}

      {%- when 'image' -%}
        <img
          src="{{ media_object | img_url: img_size }}"
          alt="{{ media_object.alt | escape }}"
          class="media__image"
          loading="{{ media_loading }}"
          {%- if media_object.width -%}
            width="{{ media_object.width }}"
          {%- endif -%}
          {%- if media_object.height -%}
            height="{{ media_object.height }}"
          {%- endif -%}
        >

      {%- when 'video' -%}
        <div class="media__badge media__badge--video">Video</div>
        {{
          media_object |
          video_tag:
            image_size: img_size,
            autoplay: media_autoplay,
            loop: media_loop,
            controls: media_show_controls,
            muted: media_autoplay,
            class: 'media__video'
        }}

      {%- when 'external_video' -%}
        <div class="media__badge media__badge--video">
          {%- if media_object.host == 'youtube' -%}
            YouTube
          {%- elsif media_object.host == 'vimeo' -%}
            Vimeo
          {%- endif -%}
        </div>
        <div class="media__external-video">
          {{
            media_object |
            external_video_tag:
              class: 'media__external-video-iframe'
          }}
        </div>

      {%- when 'model' -%}
        <div class="media__badge">3D Model</div>
        {{
          media_object |
          model_viewer_tag:
            image_size: img_size,
            reveal: 'interaction',
            toggleable: true,
            class: 'media__model'
        }}

      {%- else -%}
        <div class="media__placeholder">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <circle cx="8.5" cy="8.5" r="1.5"></circle>
            <polyline points="21 15 16 10 5 21"></polyline>
          </svg>
        </div>
    {%- endcase -%}
  </div>
{%- else -%}
  <div class="media {{ media_class }}">
    <div class="media__placeholder">
      {{ 'product-1' | placeholder_svg_tag }}
    </div>
  </div>
{%- endif -%}
