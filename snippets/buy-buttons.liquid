{%- form 'product', product, id: product_form_id -%}
  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" data-variant-id>

  <button
    type="submit"
    name="add"
    data-add-to-cart
    style="width: 100%; padding: 16px 32px; background: var(--color-brand-yellow); color: #000000; font-size: 1rem; font-weight: 700; border: none; border-radius: 8px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s ease;"
    {% unless product.selected_or_first_available_variant.available %}disabled{% endunless %}
  >
    {%- if product.selected_or_first_available_variant.available -%}
      Adicionar ao Carrinho
    {%- else -%}
      Esgotado
    {%- endif -%}
  </button>
{%- endform -%}

<script>
(function() {
  const form = document.querySelector('#{{ product_form_id }}');
  if (!form) return;

  const variantIdInput = form.querySelector('[data-variant-id]');
  const addToCartButton = form.querySelector('[data-add-to-cart]');

  // Listen for variant changes
  document.addEventListener('variant:changed', function(e) {
    const variant = e.detail.variant;
    if (!variant) return;

    variantIdInput.value = variant.id;

    if (variant.available) {
      addToCartButton.disabled = false;
      addToCartButton.textContent = 'Adicionar ao Carrinho';
      addToCartButton.style.opacity = '1';
      addToCartButton.style.cursor = 'pointer';
    } else {
      addToCartButton.disabled = true;
      addToCartButton.textContent = 'Esgotado';
      addToCartButton.style.opacity = '0.5';
      addToCartButton.style.cursor = 'not-allowed';
    }
  });
})();
</script>

<style>
  button[data-add-to-cart]:hover:not(:disabled) {
    opacity: 0.9;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(218, 241, 13, 0.3);
  }

  button[data-add-to-cart]:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>
