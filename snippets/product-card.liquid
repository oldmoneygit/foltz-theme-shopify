{%- comment -%}
  PRODUCT CARD SNIPPET
  Replicates: src/components/ProductCard.jsx
  Usage: {% render 'product-card', product: product %}
{%- endcomment -%}

<a href="{{ product.url }}" class="product-card" data-product-id="{{ product.id }}">
  <!-- Stock Badge -->
  {%- unless product.available -%}
    <div class="product-card-badge soldout">{{ 'products.sold_out' | t }}</div>
  {%- else -%}
    {%- assign total_inventory = 0 -%}
    {%- for variant in product.variants -%}
      {%- if variant.inventory_quantity > 0 -%}
        {%- assign total_inventory = total_inventory | plus: variant.inventory_quantity -%}
      {%- endif -%}
    {%- endfor -%}
    {%- if total_inventory > 0 and total_inventory <= 5 -%}
      <div class="product-card-badge limited">{{ 'products.limited_stock' | t }}</div>
    {%- endif -%}
  {%- endunless -%}

  <!-- Wishlist Button -->
  <button class="product-card-wishlist" type="button" aria-label="Add to wishlist">
    {% render 'icon-heart', size: 18 %}
  </button>

  <!-- Product Image - Optimized Loading -->
  <div class="product-card-image">
    {%- if product.featured_image -%}
      <img
        src="{{ product.featured_image | img_url: '600x' }}"
        srcset="
          {{ product.featured_image | img_url: '300x' }} 300w,
          {{ product.featured_image | img_url: '400x' }} 400w,
          {{ product.featured_image | img_url: '600x' }} 600w,
          {{ product.featured_image | img_url: '800x' }} 800w
        "
        sizes="(min-width: 1400px) 25vw, (min-width: 1024px) 33vw, (min-width: 768px) 33vw, 50vw"
        alt="{{ product.featured_image.alt | default: product.title | escape }}"
        loading="lazy"
        decoding="async"
        width="600"
        height="800"
        class="product-card-image__img"
      >
    {%- else -%}
      <img
        src="{{ 'product-placeholder.png' | asset_url }}"
        alt="{{ product.title | escape }}"
        loading="lazy"
        decoding="async"
        class="product-card-image__img"
      >
    {%- endif -%}
  </div>

  <!-- Product Content -->
  <div class="product-card-content">
    <!-- Product Name -->
    <h3 class="product-card-name">{{ product.title }}</h3>

    <!-- Prices -->
    <div class="product-card-prices">
      {%- comment %} Calcular compare_at_price como 50% a mais (pre√ßo * 1.5) {%- endcomment -%}
      {%- assign calculated_compare_price = product.price | times: 1.5 | round -%}

      <p class="product-card-price-regular">
        {{ calculated_compare_price | money }}
      </p>

      <p class="product-card-price-sale">
        {{ product.price | money }}
      </p>

      <!-- COMPRA 1 LLEVA 3 Badge -->
      {%- if product.available -%}
        <div class="product-card-promo">
          <span>COMPRA 1 LLEVA 3</span>
        </div>
      {%- endif -%}
    </div>
  </div>
</a>
