{%- capture product_form_id -%}product-form-{{ product.id }}-{{ section.id }}{%- endcapture -%}

<div class="product-info">
  {%- for block in section.blocks -%}
    {%- case block.type -%}

      {%- when 'title' -%}
        <div class="product-info__header" {{ block.shopify_attributes }}>
          <h1 class="product-info__title">
            {{ product.title }}
          </h1>
        </div>

        {%- comment %} Urgency & Scarcity Banner {%- endcomment -%}
        <div class="urgency-banner">
          <div class="urgency-banner__main">
            <div class="urgency-banner__icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
            </div>
            <div class="urgency-banner__content">
              <p class="urgency-banner__title">🔥 ¡PROMOCIÓN 3x1 TERMINANDO!</p>
              <p class="urgency-banner__timer">
                Tiempo restante: <span id="urgency-timer">--:--:--</span>
              </p>
            </div>
          </div>
          <div class="urgency-banner__demand">
            <div class="urgency-banner__demand-indicator">
              <div class="urgency-banner__demand-bar"></div>
            </div>
            <p class="urgency-banner__demand-text">
              <span class="urgency-banner__demand-icon">👥</span>
              <span id="demand-viewers">12</span> personas están viendo esto ahora
            </p>
          </div>
          <div class="urgency-banner__stock">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <span>Solo quedan <strong id="stock-count">7</strong> unidades en stock</span>
          </div>
        </div>

      {%- when 'price' -%}
        <div class="product-info__promo-banner" {{ block.shopify_attributes }}>
          <img
            src="{{ 'etiqueta-promocional.jpeg' | asset_url }}"
            alt="Compra 1 y gana 2 camisetas gratis"
            class="promo-banner__image"
            loading="eager"
          >
        </div>

        <div class="product-info__price" {{ block.shopify_attributes }}>
          {%- assign current_variant = product.selected_or_first_available_variant -%}
          {%- assign price = current_variant.price -%}

          {%- comment %} Calcular compare_at_price como 50% a mais (preço * 1.5) {%- endcomment -%}
          {%- assign compare_at_price = price | times: 1.5 | round -%}
          {%- assign on_sale = true -%}

          <div class="price-container">
            <div class="price-main on-sale">
              {{ price | money }}
            </div>

            <div class="price-compare">
              {{ compare_at_price | money }}
            </div>

            {%- comment %} Sempre mostra 50% de desconto {%- endcomment -%}
            <span class="price-discount-badge">
              -33%
            </span>
          </div>
        </div>

      {%- when 'variant_picker' -%}
        <div class="product-info__variants" {{ block.shopify_attributes }}>
          {%- render 'variant-picker', product: product, product_form_id: product_form_id -%}
        </div>

      {%- when 'quantity' -%}
        <div class="product-info__quantity" {{ block.shopify_attributes }}>
          {%- render 'quantity-selector', product_form_id: product_form_id -%}
        </div>

      {%- when 'buy_buttons' -%}
        <div class="product-info__buy-buttons" {{ block.shopify_attributes }}>
          {%- render 'buy-buttons', product: product, product_form_id: product_form_id -%}
        </div>

      {%- when 'description' -%}
        {%- if product.description != blank -%}
          <div class="product-info__features" {{ block.shopify_attributes }}>
            <div class="feature-item">
              <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
              </svg>
              <div class="feature-content">
                <p class="feature-title">Calidad Premium 1:1</p>
                <p class="feature-desc">Máxima calidad garantizada</p>
              </div>
            </div>

            <div class="feature-item">
              <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="3" width="15" height="13"></rect>
                <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                <circle cx="5.5" cy="18.5" r="2.5"></circle>
                <circle cx="18.5" cy="18.5" r="2.5"></circle>
              </svg>
              <div class="feature-content">
                <p class="feature-title">Envío Rápido</p>
                <p class="feature-desc">Recibís en 3-5 días hábiles</p>
              </div>
            </div>

            <div class="feature-item">
              <svg class="feature-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
              </svg>
              <div class="feature-content">
                <p class="feature-title">Compra Segura</p>
                <p class="feature-desc">Protección al comprador</p>
              </div>
            </div>
          </div>

          <div class="product-info__description-full">
            <div class="description-box">
              <h2 class="description-title">Descripción</h2>
              <div class="description-content">
                {{ product.description }}
              </div>
            </div>
          </div>
        {%- endif -%}

    {%- endcase -%}
  {%- endfor -%}
</div>

{%- comment -%} JSON-LD Structured Data for SEO {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org/",
  "@type": "Product",
  "name": {{ product.title | json }},
  "description": {{ product.description | strip_html | truncate: 300 | json }},
  "image": [
    {%- for image in product.images limit: 5 -%}
      "https:{{ image | img_url: '1200x1200' }}"{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ],
  "brand": {
    "@type": "Brand",
    "name": {{ shop.name | json }}
  },
  "sku": {{ product.selected_or_first_available_variant.sku | default: product.id | json }},
  {%- if product.selected_or_first_available_variant.barcode != blank -%}
  "gtin": {{ product.selected_or_first_available_variant.barcode | json }},
  {%- endif -%}
  "offers": {
    "@type": "AggregateOffer",
    "url": {{ product.url | within: collection | json }},
    "priceCurrency": {{ shop.currency | json }},
    "lowPrice": {{ product.price_min | divided_by: 100.0 | json }},
    "highPrice": {{ product.price_max | divided_by: 100.0 | json }},
    "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
    "offerCount": {{ product.variants.size | json }}
  }
  {%- if product.metafields.reviews.rating.value != blank -%}
  ,
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": {{ product.metafields.reviews.rating.value | json }},
    "ratingCount": {{ product.metafields.reviews.rating_count | json }}
  }
  {%- endif -%}
}
</script>

<style>
  .product-info {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  @media (min-width: 768px) {
    .product-info {
      gap: 16px;
    }
  }

  @media (min-width: 1024px) {
    .product-info {
      gap: 24px;
    }
  }

  /* Header & Title */
  .product-info__header {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .product-info__title {
    font-size: 1.125rem;
    font-weight: 700;
    color: #FFFFFF;
    line-height: 1.3;
    margin: 0;
    text-transform: uppercase;
  }

  @media (min-width: 768px) {
    .product-info__title {
      font-size: 1.5rem;
      line-height: 1.25;
    }
  }

  @media (min-width: 1024px) {
    .product-info__title {
      font-size: 1.875rem;
    }
  }

  .product-info__tags {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .product-tag {
    font-size: 0.75rem;
    color: rgba(218, 241, 13, 0.8);
    background: rgba(218, 241, 13, 0.1);
    padding: 4px 8px;
    border-radius: 4px;
  }

  /* Promotional Banner */
  .product-info__promo-banner {
    margin: 8px 0;
    width: 100%;
  }

  .promo-banner__image {
    width: 100%;
    max-width: 100%;
    height: auto;
    display: block;
    object-fit: contain;
  }

  @media (min-width: 768px) {
    .promo-banner__image {
      max-width: 450px;
    }
  }

  @media (min-width: 1024px) {
    .promo-banner__image {
      max-width: 520px;
    }
  }

  /* Price */
  .product-info__price {
    padding: 12px 0;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  @media (min-width: 768px) {
    .product-info__price {
      padding: 16px 0;
    }
  }

  .price-container {
    display: flex;
    align-items: baseline;
    gap: 12px;
    flex-wrap: wrap;
  }

  .price-main {
    font-size: 1.75rem;
    font-weight: 700;
    color: #DAF10D;
    flex-shrink: 0;
  }

  @media (min-width: 750px) {
    .price-main {
      font-size: 2rem;
    }
  }

  @media (min-width: 990px) {
    .price-main {
      font-size: 2.5rem;
    }
  }

  .price-compare {
    font-size: 0.85rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.4);
    text-decoration: line-through;
    flex-shrink: 0;
  }

  .price-discount-badge {
    background: #EF4444;
    color: #FFFFFF;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 4px 8px;
    border-radius: 4px;
    flex-shrink: 0;
  }

  /* Features */
  .product-info__features {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding-top: 16px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .feature-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
  }

  .feature-icon {
    width: 20px;
    height: 20px;
    color: #DAF10D;
    flex-shrink: 0;
    margin-top: 2px;
  }

  .feature-content {
    flex: 1;
  }

  .feature-title {
    color: #FFFFFF;
    font-weight: 600;
    font-size: 0.875rem;
    margin: 0 0 2px 0;
  }

  .feature-desc {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.75rem;
    margin: 0;
  }

  /* Description */
  .product-info__description-full {
    margin-top: 16px;
  }

  .description-box {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 24px;
  }

  @media (min-width: 768px) {
    .description-box {
      padding: 32px;
    }
  }

  .description-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #FFFFFF;
    margin: 0 0 16px 0;
  }

  .description-content {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.8;
  }

  .description-content h2,
  .description-content h3 {
    color: #FFFFFF;
    margin: 16px 0 8px 0;
  }

  .description-content ul {
    margin: 8px 0;
    padding-left: 20px;
  }

  .description-content li {
    margin: 4px 0;
  }

  /* ========================================
     MOBILE: Reduzir tamanhos (< 750px)
     ======================================== */
  @media screen and (max-width: 749px) {
    /* Título do produto: AUMENTADO e UPPERCASE */
    .product-info__title {
      font-size: 1.25rem !important;
      line-height: 1.2;
      text-transform: uppercase !important;
      font-weight: 700 !important;
    }

    /* Tags: 0.75rem → 0.65rem */
    .product-tag {
      font-size: 0.65rem !important;
      padding: 3px 6px !important;
    }

    /* Promo Banner Image */
    .promo-banner__image {
      max-width: 100% !important;
    }

    /* Preço: AUMENTADO promocional, DIMINUÍDO comparado */
    .product-info__price-current {
      font-size: 1.5rem !important;
      font-weight: 700 !important;
    }

    .product-info__price-compare {
      font-size: 0.65rem !important;
    }

    .product-info__price-badge {
      font-size: 0.7rem !important;
      padding: 3px 6px !important;
    }

    /* Seção de tamanhos */
    .product-info__size-label {
      font-size: 0.75rem !important;
    }

    .product-info__size-guide {
      font-size: 0.65rem !important;
    }

    /* Botões de tamanho */
    .size-button {
      padding: 10px 6px !important;
      font-size: 0.85rem !important;
      min-width: 45px !important;
    }

    /* Quantidade */
    .product-info__quantity-label {
      font-size: 0.75rem !important;
    }

    .quantity-input {
      font-size: 0.85rem !important;
      padding: 10px !important;
    }

    .quantity-button {
      font-size: 0.95rem !important;
    }

    /* Reduzir gaps e espaçamentos */
    .product-info {
      gap: 10px !important;
    }

    .product-info__header {
      gap: 6px !important;
    }

    .product-info__tags {
      gap: 6px !important;
    }

    .product-info__price {
      gap: 8px !important;
      padding: 10px 0 !important;
    }

    .product-info__size-options {
      gap: 6px !important;
    }

    .product-info__quantity {
      gap: 8px !important;
    }

    /* Descrição */
    .product-info__description-title {
      font-size: 0.85rem !important;
    }

    .description-content {
      font-size: 0.75rem !important;
      padding: 16px !important;
    }
  }

  /* ========================================
     URGENCY & SCARCITY BANNER
     ======================================== */
  .urgency-banner {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05));
    border: 2px solid rgba(239, 68, 68, 0.3);
    border-radius: 12px;
    padding: 16px;
    margin: 12px 0;
    animation: urgencyPulse 2s ease-in-out infinite;
  }

  @keyframes urgencyPulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
    }
    50% {
      box-shadow: 0 0 20px 0 rgba(239, 68, 68, 0.2);
    }
  }

  .urgency-banner__main {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .urgency-banner__icon {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, #EF4444, #DC2626);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    animation: urgencyIconSpin 3s linear infinite;
  }

  @keyframes urgencyIconSpin {
    0%, 90% {
      transform: rotate(0deg);
    }
    95% {
      transform: rotate(10deg);
    }
    100% {
      transform: rotate(0deg);
    }
  }

  .urgency-banner__icon svg {
    color: #FFFFFF;
  }

  .urgency-banner__content {
    flex: 1;
  }

  .urgency-banner__title {
    font-size: 0.875rem;
    font-weight: 900;
    color: #FFFFFF;
    margin: 0 0 4px 0;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  @media (min-width: 768px) {
    .urgency-banner__title {
      font-size: 1rem;
    }
  }

  .urgency-banner__timer {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.85);
    margin: 0;
    font-weight: 600;
  }

  .urgency-banner__timer span {
    color: #DAF10D;
    font-weight: 900;
    font-size: 0.875rem;
    font-family: monospace;
  }

  .urgency-banner__demand {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    padding: 10px 12px;
    margin-bottom: 10px;
  }

  .urgency-banner__demand-indicator {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 8px;
  }

  .urgency-banner__demand-bar {
    height: 100%;
    background: linear-gradient(90deg, #DAF10D, #FAFF00);
    width: 75%;
    border-radius: 2px;
    animation: demandPulse 2s ease-in-out infinite;
  }

  @keyframes demandPulse {
    0%, 100% {
      width: 75%;
    }
    50% {
      width: 85%;
    }
  }

  .urgency-banner__demand-text {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
  }

  .urgency-banner__demand-icon {
    font-size: 1rem;
  }

  .urgency-banner__demand-text span:not(.urgency-banner__demand-icon) {
    color: #DAF10D;
    font-weight: 900;
  }

  .urgency-banner__stock {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
  }

  @media (min-width: 768px) {
    .urgency-banner__stock {
      font-size: 0.8125rem;
    }
  }

  .urgency-banner__stock svg {
    color: #10B981;
    flex-shrink: 0;
  }

  .urgency-banner__stock strong {
    color: #DAF10D;
    font-weight: 900;
  }

  /* Mobile adjustments */
  @media screen and (max-width: 749px) {
    .urgency-banner {
      padding: 12px;
      margin: 10px 0;
    }

    .urgency-banner__main {
      gap: 10px;
      margin-bottom: 10px;
    }

    .urgency-banner__icon {
      width: 32px;
      height: 32px;
    }

    .urgency-banner__icon svg {
      width: 16px;
      height: 16px;
    }

    .urgency-banner__title {
      font-size: 0.8125rem !important;
    }

    .urgency-banner__timer {
      font-size: 0.6875rem;
    }

    .urgency-banner__timer span {
      font-size: 0.8125rem;
    }

    .urgency-banner__demand {
      padding: 8px 10px;
      margin-bottom: 8px;
    }

    .urgency-banner__demand-text {
      font-size: 0.6875rem;
    }

    .urgency-banner__stock {
      font-size: 0.6875rem;
    }
  }
</style>

<script>
(function() {
  // Urgency Timer - 24 hour countdown
  function initUrgencyTimer() {
    const timerElement = document.getElementById('urgency-timer');
    if (!timerElement) return;

    // Check if there's a stored end time
    let endTime = localStorage.getItem('foltz_promo_end');

    if (!endTime || new Date(endTime) < new Date()) {
      // Set new end time to 24 hours from now
      endTime = new Date(Date.now() + 24 * 60 * 60 * 1000).getTime();
      localStorage.setItem('foltz_promo_end', endTime);
    }

    function updateTimer() {
      const now = new Date().getTime();
      const distance = endTime - now;

      if (distance < 0) {
        // Reset timer to 24 hours when it reaches 0
        endTime = new Date(Date.now() + 24 * 60 * 60 * 1000).getTime();
        localStorage.setItem('foltz_promo_end', endTime);
        return;
      }

      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      timerElement.textContent =
        String(hours).padStart(2, '0') + ':' +
        String(minutes).padStart(2, '0') + ':' +
        String(seconds).padStart(2, '0');
    }

    updateTimer();
    setInterval(updateTimer, 1000);
  }

  // Dynamic viewers count - varies between 8-15
  function initViewersCount() {
    const viewersElement = document.getElementById('demand-viewers');
    if (!viewersElement) return;

    function updateViewers() {
      const count = Math.floor(Math.random() * 8) + 8; // 8-15
      viewersElement.textContent = count;
    }

    updateViewers();
    setInterval(updateViewers, 15000); // Update every 15 seconds
  }

  // Dynamic stock count - varies between 3-9
  function initStockCount() {
    const stockElement = document.getElementById('stock-count');
    if (!stockElement) return;

    function updateStock() {
      const count = Math.floor(Math.random() * 7) + 3; // 3-9
      stockElement.textContent = count;

      // Change color if stock is very low
      const banner = document.querySelector('.urgency-banner__stock');
      if (banner) {
        if (count <= 4) {
          stockElement.style.color = '#EF4444'; // Red
        } else {
          stockElement.style.color = '#DAF10D'; // Yellow
        }
      }
    }

    updateStock();
    setInterval(updateStock, 20000); // Update every 20 seconds
  }

  // Initialize all urgency features
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      initUrgencyTimer();
      initViewersCount();
      initStockCount();
    });
  } else {
    initUrgencyTimer();
    initViewersCount();
    initStockCount();
  }
})();
</script>
